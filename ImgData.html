<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Image Data Reader</title>
        <meta name="author" content="Brendan Luke">
        <meta name="description" content="read image data to get RGB data">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <label>Image File:</label><br/>
        <input type="file" id="imageLoader" name="imageLoader"/>
        <canvas id="imageCanvas" width="100" height="100" style="border: 1px solid black;"></canvas>
        <button onclick="imgDataFunc()">Click me for RGB</button>
        <div style="width: 90vw;"> <p id="writeMe"></p></div>
    </body>
    <script>
        var imageLoader = document.getElementById('imageLoader');
            imageLoader.addEventListener('change', handleImage, false);
        var canvas = document.getElementById('imageCanvas');
        var ctx = canvas.getContext('2d');


        function handleImage(e) {
            var reader = new FileReader();
            reader.onload = function(event) {
                var img = new Image();
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    //ctx.drawImage(img,0,0);
                    ctx.drawImage(img,0,0,canvas.width,canvas.height);
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(e.target.files[0]);     
        }

        function imgDataFunc() {
            context = document.getElementById('imageCanvas').getContext('2d');
            width = document.getElementById('imageCanvas').width;
            height = document.getElementById('imageCanvas').height;
            imgd = context.getImageData(0,0,width,height);
            pix = imgd.data;
            Red = [];     
            Green = [];
            Blue = [];

            // Loop over each pixel
            for (i = 0; i < height; i++) { // for each row of image
                RedTemp = [];
                GreenTemp = [];
                BlueTemp = [];
                for (j = 0; j < width; j++) { // for each pixel in row
                    n = j*width + i; // pixel number
                    RedTemp[j] = pix[4*n + 0];
                    GreenTemp[j] = pix[4*n + 1];
                    BlueTemp[j] = pix[4*n + 2];
                }
                Red[i] = RedTemp;
                Green[i] = GreenTemp;
                Blue[i] = BlueTemp;

                //data = context.getImageData(n,n,1,1).data;

                //rgb[i] = [ data[0], data[1], data[2] ];
                //pix[i  ] = 255 - pix[i  ]; // red
                //pix[i+1] = 255 - pix[i+1]; // green
                //pix[i+2] = 255 - pix[i+2]; // blue
                // i+3 is alpha (the fourth element)

                
            }
            document.getElementById('writeMe').innerText = Red;
            console.log('finished');
        }

    </script>
</html>